<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1, user-scalable=no, shrink-to-fit=yes" />
    <title>Unity WebGL Player | SnakeRoyale</title>
    <style>
      html, body { margin:0; height:100%; background:#000; }
      /* Fullscreen canvas */
      #unity-canvas {
        position:fixed; left:0; top:0;
        width:100vw; height:100svh;   /* JS will also set exact px sizes */
        display:block; background:#000;
        touch-action:none;
      }

      /* Splash overlay */
      #custom-loader {
        position:fixed; inset:0; z-index:9999;
        display:flex; align-items:flex-end; justify-content:center;
        background:#0a0e1a url("Survival_BG.png") center/cover no-repeat;
        transition:opacity .35s ease;
      }
      #custom-loader.hidden { opacity:0; pointer-events:none; }
      #progress-wrap {
        width:min(80vw, 520px); height:16px; margin:32px auto 8vh;
        background:rgba(255,255,255,.15); border-radius:12px; overflow:hidden;
        box-shadow:0 2px 12px rgba(0,0,0,.4) inset;
        position:relative;
      }
      #progress-bar {
        width:0%; height:100%;
        background:linear-gradient(90deg, rgba(255,204,64,.9), rgba(255,127,80,.9));
        transition:width .15s ease;
      }
      #progress-text {
        position:absolute; bottom:calc(8vh + 24px); left:50%; transform:translateX(-50%);
        font:600 14px/1 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.6);
      }
      /* Direct Input Field Styling */
#__unity_direct_input {
    position: fixed !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    width: 80% !important;
    max-width: 400px !important;
    height: 50px !important;
    padding: 12px 16px !important;
    font-size: 18px !important;
    border: 2px solid #4CAF50 !important;
    border-radius: 8px !important;
    background: white !important;
    color: black !important;
    z-index: 2147483647 !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3) !important;
    font-family: system-ui, -apple-system, sans-serif !important;
}

/* Backdrop shown when the direct input is present */
#__unity_direct_input_backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  z-index: 2147483646;
  display: none;
}

/* Auto-show the backdrop when the input exists (modern mobile Safari/Chrome support) */
body:has(#__unity_direct_input) #__unity_direct_input_backdrop {
  display: block;
}

    </style>
  </head>

  <body>
    <!-- Splash overlay -->
    <div id="custom-loader">
      <div id="progress-wrap"><div id="progress-bar"></div></div>
      <div id="progress-text">Loading… 0%</div>
    </div>

    <!-- Unity canvas -->
    <canvas id="unity-canvas" tabindex="-1"></canvas>
    <div id="__unity_direct_input_backdrop"></div>
    <!-- Loader -->
    <script src="Build/SnakeRoyaleBuild.loader.js"></script>

    <script>
      // ===== Fullscreen & resize =====
      const canvas = document.getElementById('unity-canvas');

      // Set to true if you want to control the WebGL buffer size too.
      // If you set this to true, also set matchWebGLToCanvasSize:false in config below.
      const MANUAL_BUFFER_SIZING = false;

      function resizeCanvas() {
        const w = window.innerWidth;
        const h = window.innerHeight;

        // CSS size (always)
        canvas.style.width  = w + 'px';
        canvas.style.height = h + 'px';

        // WebGL buffer size (only if manually controlling it)
        if (MANUAL_BUFFER_SIZING) {
          const dpr = Math.min(window.devicePixelRatio || 1, 1.5);
          canvas.width  = Math.round(w * dpr);
          canvas.height = Math.round(h * dpr);
        }
      }

      // iOS address-bar quirks: apply multiple times
      function applyResizeSoon(){
        resizeCanvas();
        setTimeout(resizeCanvas, 0);
        setTimeout(resizeCanvas, 250);
      }

      window.addEventListener('resize', applyResizeSoon);
      window.addEventListener('orientationchange', applyResizeSoon);
      document.addEventListener('DOMContentLoaded', applyResizeSoon);

      // ===== Splash progress =====
      const splash = document.getElementById('custom-loader');
      const bar = document.getElementById('progress-bar');
      const txt = document.getElementById('progress-text');

      function setProgress(p) {
        const pct = Math.min(100, Math.max(0, Math.round(p * 100)));
        bar.style.width = pct + '%';
        txt.textContent = 'Loading… ' + pct + '%';
      }

      // Unity will call this when YOU decide to hide the splash
      window.hideSplashScreen = () => {
        let current = parseInt((bar && bar.style && bar.style.width) ? bar.style.width : "0", 10) || 0;
        const interval = setInterval(() => {
          current += 2;
          if (current >= 100) {
            current = 100;
            clearInterval(interval);
            if (splash) splash.classList.add('hidden');
          }
          if (bar) bar.style.width = current + "%";
          if (txt) txt.textContent = "Loading… " + current + "%";
        }, 20);
      };

      // ===== Unity boot =====
      const config = {
        dataUrl: "Build/Survival_Build.data.unityweb",
        frameworkUrl: "Build/Survival_Build.framework.js.unityweb",
        codeUrl: "Build/Survival_Build.wasm.unityweb",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Survival",
        productVersion: "1.0.17",
        // If you enable MANUAL_BUFFER_SIZING above, uncomment the next line:
        // matchWebGLToCanvasSize: false,
        devicePixelRatio: Math.min(window.devicePixelRatio || 1, 1.5),
      };

      createUnityInstance(canvas, config, setProgress)
        .then((unityInstance) => {
          // Do NOT auto-hide splash here.
          // Keep it visible until Unity explicitly calls window.hideSplashScreen().
          window.unityInstance = unityInstance;
          applyResizeSoon();
        })
        .catch((message) => {
          txt.textContent = 'Error loading: ' + message;
        });
    </script>
  </body>
</html>
